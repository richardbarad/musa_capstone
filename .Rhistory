cluster_means %>%
kbl() %>%
kable_minimal() %>%
column_spec(2,background=ifelse(cluster_means$flood_pct > quantiles[4,1],'red','white')) %>%
column_spec(3,background=ifelse(cluster_means$pct_minority > quantiles[4,2],'red','white')) %>%
column_spec(4,background=ifelse(cluster_means$pct_non_english > quantiles[4,3],'red','white')) %>%
column_spec(5,background=ifelse(cluster_means$pct_poverty > quantiles[4,4],'red','white')) %>%
column_spec(6,background=ifelse(cluster_means$pct_no_university > quantiles[4,5],'red','white')) %>%
column_spec(7,background=ifelse(cluster_means$air_index > quantiles[4,6],'red','white')) %>%
column_spec(8,background=ifelse(cluster_means$fire > quantiles[4,7],'red','white')) %>%
column_spec(9,background=ifelse(cluster_means$Wastewater > quantiles[4,8],'red','white')) %>%
column_spec(10,background=ifelse(cluster_means$health_hazard_index > quantiles[4,9],'red','white')) %>%
column_spec(11,background=ifelse(cluster_means$waste_proximity > quantiles[4,10],'red','white'))
clusters <- kmeans(basin_tracts_final_scalled, centers=9, nstart=25)$cluster
results <- cbind(basin_tracts_4 %>% select('geometry'),basin_tracts_final_scalled,clusters)
ggplot()+
geom_sf(data=results,aes(fill=as.factor(clusters)),color='transparent')+
theme_void()
basin_tracts_final <- basin_tracts_4 %>%
select(flood_pct, pct_minority, pct_non_english, pct_poverty, pct_no_university, air_index, fire, PNPL, PTSDF, UST, PWDIS,health_hazard_index) %>%
mutate(waste_proximity = PNPL + PTSDF + UST,
PWDIS = percent_rank(PWDIS)) %>%
rename(Wastewater = PWDIS) %>%
select(-PNPL, -PTSDF, -UST) %>%
st_drop_geometry() %>%
drop_na()
process <- preProcess(basin_tracts_final, method=c("range"))
basin_tracts_final_scalled <- predict(process, basin_tracts_final)
clusters <- kmeans(basin_tracts_final_scalled, centers=9, nstart=25)$cluster
results <- cbind(basin_tracts_4 %>% select('geometry'),basin_tracts_final_scalled,clusters)
ggplot()+
geom_sf(data=results,aes(fill=as.factor(clusters)),color='transparent')+
theme_void()
cluster_means <- results %>% group_by(clusters) %>% st_drop_geometry() %>% summarise_all(mean) %>% mutate_if(is.numeric, round, digits=2)
quantiles <- sapply(basin_tracts_final_scalled, function(x) quantile(x, na.rm = TRUE))
cluster_means %>%
kbl() %>%
kable_minimal() %>%
column_spec(2,background=ifelse(cluster_means$flood_pct > quantiles[4,1],'red','white')) %>%
column_spec(3,background=ifelse(cluster_means$pct_minority > quantiles[4,2],'red','white')) %>%
column_spec(4,background=ifelse(cluster_means$pct_non_english > quantiles[4,3],'red','white')) %>%
column_spec(5,background=ifelse(cluster_means$pct_poverty > quantiles[4,4],'red','white')) %>%
column_spec(6,background=ifelse(cluster_means$pct_no_university > quantiles[4,5],'red','white')) %>%
column_spec(7,background=ifelse(cluster_means$air_index > quantiles[4,6],'red','white')) %>%
column_spec(8,background=ifelse(cluster_means$fire > quantiles[4,7],'red','white')) %>%
column_spec(9,background=ifelse(cluster_means$Wastewater > quantiles[4,8],'red','white')) %>%
column_spec(10,background=ifelse(cluster_means$health_hazard_index > quantiles[4,9],'red','white')) %>%
column_spec(11,background=ifelse(cluster_means$waste_proximity > quantiles[4,10],'red','white'))
ggplot(data=results_long)+
geom_boxplot(aes(x=as.factor(clusters),y=value,fill=as.factor(clusters)))+
geom_hline(data=means,aes(yintercept=value),color='orange',linewidth=1)+
geom_hline(data=q3,aes(yintercept=value),color='red',linewidth=1)+
facet_wrap(~variables)+
theme_bw()
ggplot(data=results_long)+
geom_boxplot(aes(x=as.factor(clusters),y=value,fill=as.factor(clusters)))+
geom_hline(data=means,aes(yintercept=value),color='orange',linewidth=1)+
geom_hline(data=q3,aes(yintercept=value),color='red',linewidth=1)+
facet_wrap(~variables,nrows=2)+
theme_bw()
ggplot(data=results_long)+
geom_boxplot(aes(x=as.factor(clusters),y=value,fill=as.factor(clusters)))+
geom_hline(data=means,aes(yintercept=value),color='orange',linewidth=1)+
geom_hline(data=q3,aes(yintercept=value),color='red',linewidth=1)+
facet_wrap(~variables,nrow=2)+
theme_bw()
ggplot(data=results_long)+
geom_violin(aes(x=as.factor(clusters),y=value,fill=as.factor(clusters)))+
geom_hline(data=means,aes(yintercept=value),color='orange',linewidth=1)+
geom_hline(data=q3,aes(yintercept=value),color='red',linewidth=1)+
facet_wrap(~variables,nrow=2)+
theme_bw()
basin_tracts_final <- basin_tracts_4 %>%
select(flood_pct, pct_minority, pct_non_english, pct_poverty, pct_no_university, air_index, PNPL, PTSDF, UST, PWDIS,health_hazard_index) %>%
mutate(waste_proximity = PNPL + PTSDF + UST,
PWDIS = percent_rank(PWDIS)) %>%
rename(Wastewater = PWDIS) %>%
select(-PNPL, -PTSDF, -UST) %>%
st_drop_geometry() %>%
drop_na()
process <- preProcess(basin_tracts_final, method=c("range"))
basin_tracts_final_scalled <- predict(process, basin_tracts_final)
wss <- c()
for (i in seq(from=2,to=25,by=1)) wss[i] <- sum(kmeans(basin_tracts_final_scalled, centers=i, nstart=25)$withinss)
bind <- cbind(clusters = seq(from=1,to=25,by=1),wss) %>%
as.data.frame() %>%
dplyr::filter(clusters > 1)
ggplot(data=bind)+
geom_line(aes(x=clusters,y=wss),linewidth=0.5,color='gray60')+
geom_point(aes(x=clusters,y=wss),size=1.5,color='gray60')+
geom_point(data = bind %>% filter(clusters == 9),aes(x=clusters,y=wss,label=clusters),size=2.5,color='red')+
geom_text(data = bind %>% filter(clusters != 9),aes(x=clusters + 0.2,y=wss + 10,label=clusters),size=3,color='gray60')+
geom_text(data = bind %>% filter(clusters == 6),aes(x=clusters + 0.3,y=wss + 15,label=clusters),size=5,color='red')+
scale_x_continuous(breaks=seq(from=2,to=25,by=1))+
labs(x='Number of Clusters',y='Within groups sum of squares')+
theme_bw()+
theme(panel.border = element_blank(),panel.grid.major.x= element_blank(),panel.grid.minor = element_blank(),axis.text.x = element_blank(),axis.ticks.x = element_blank())
wss <- c()
for (i in seq(from=2,to=25,by=1)) wss[i] <- sum(kmeans(basin_tracts_final_scalled, centers=i, nstart=25)$withinss)
bind <- cbind(clusters = seq(from=1,to=25,by=1),wss) %>%
as.data.frame() %>%
dplyr::filter(clusters > 1)
ggplot(data=bind)+
geom_line(aes(x=clusters,y=wss),linewidth=0.5,color='gray60')+
geom_point(aes(x=clusters,y=wss),size=1.5,color='gray60')+
geom_point(data = bind %>% filter(clusters == 9),aes(x=clusters,y=wss,label=clusters),size=2.5,color='red')+
geom_text(data = bind %>% filter(clusters != 9),aes(x=clusters + 0.2,y=wss + 10,label=clusters),size=3,color='gray60')+
geom_text(data = bind %>% filter(clusters == 9),aes(x=clusters + 0.3,y=wss + 15,label=clusters),size=5,color='red')+
scale_x_continuous(breaks=seq(from=2,to=25,by=1))+
labs(x='Number of Clusters',y='Within groups sum of squares')+
theme_bw()+
theme(panel.border = element_blank(),panel.grid.major.x= element_blank(),panel.grid.minor = element_blank(),axis.text.x = element_blank(),axis.ticks.x = element_blank())
clusters <- kmeans(basin_tracts_final_scalled, centers=9, nstart=25)$cluster
results <- cbind(basin_tracts_4 %>% select('geometry'),basin_tracts_final_scalled,clusters)
ggplot()+
geom_sf(data=results,aes(fill=as.factor(clusters)),color='transparent')+
theme_void()
cluster_means <- results %>% group_by(clusters) %>% st_drop_geometry() %>% summarise_all(mean) %>% mutate_if(is.numeric, round, digits=2)
quantiles <- sapply(basin_tracts_final_scalled, function(x) quantile(x, na.rm = TRUE))
cluster_means %>%
kbl() %>%
kable_minimal() %>%
column_spec(2,background=ifelse(cluster_means$flood_pct > quantiles[4,1],'red','white')) %>%
column_spec(3,background=ifelse(cluster_means$pct_minority > quantiles[4,2],'red','white')) %>%
column_spec(4,background=ifelse(cluster_means$pct_non_english > quantiles[4,3],'red','white')) %>%
column_spec(5,background=ifelse(cluster_means$pct_poverty > quantiles[4,4],'red','white')) %>%
column_spec(6,background=ifelse(cluster_means$pct_no_university > quantiles[4,5],'red','white')) %>%
column_spec(7,background=ifelse(cluster_means$air_index > quantiles[4,6],'red','white')) %>%
column_spec(8,background=ifelse(cluster_means$Wastewater > quantiles[4,7],'red','white')) %>%
column_spec(9,background=ifelse(cluster_means$health_hazard_index > quantiles[4,8],'red','white')) %>%
column_spec(10,background=ifelse(cluster_means$waste_proximity > quantiles[4,9],'red','white'))
t <- quantiles[2:4,] %>% as_data_frame() %>%
cbind(.,stat=c('Q1','Mean','Q3')) %>%
pivot_longer(-stat,names_to='variables',values_to='value')
means <- t %>%
filter(stat == "Mean")
q3 <- t %>%
filter(stat == "Q3")
results_long <- results %>%
st_drop_geometry() %>%
pivot_longer(-clusters,names_to='variables',values_to='value')
ggplot(data=results_long)+
geom_violin(aes(x=as.factor(clusters),y=value,fill=as.factor(clusters)))+
geom_hline(data=means,aes(yintercept=value),color='orange',linewidth=1)+
geom_hline(data=q3,aes(yintercept=value),color='red',linewidth=1)+
facet_wrap(~variables,nrow=2)+
theme_bw()
ggsave('image1.png')
ggplot(data=results_long)+
geom_boxplot(aes(x=as.factor(clusters),y=value,fill=as.factor(clusters)))+
geom_hline(data=means,aes(yintercept=value),color='orange',linewidth=1)+
geom_hline(data=q3,aes(yintercept=value),color='red',linewidth=1)+
facet_wrap(~variables,nrow=2)+
theme_bw()
t <- quantiles[2:4,] %>% as_data_frame() %>%
cbind(.,stat=c('Q1','Mean','Q3')) %>%
pivot_longer(-stat,names_to='variables',values_to='value')
means <- t %>%
filter(stat == "Mean")
q3 <- t %>%
filter(stat == "Q3")
results_long <- results %>%
st_drop_geometry() %>%
pivot_longer(-clusters,names_to='variables',values_to='value')
ggplot(data=results_long)+
geom_boxplot(aes(x=as.factor(clusters),y=value,fill=as.factor(clusters)))+
geom_hline(data=means,aes(yintercept=value),color='orange',linewidth=1)+
geom_hline(data=q3,aes(yintercept=value),color='red',linewidth=1)+
facet_wrap(~variables,nrow=2)+
theme_bw()
ggsave('image1.png')
View(results)
t <- results %>%
st_drop_geometry() %>%
groupby(clusters) %>% quantiles()
t <- results %>%
st_drop_geometry() %>%
groupby(clusters) %>% quantile()
t <- results %>%
st_drop_geometry() %>%
group_by(clusters) %>% quantile()
t <- results %>%
st_drop_geometry() %>%
group_by(clusters) %>% summarise_all(quantile)
View(t)
t1 <- results %>%
st_drop_geometry() %>%
group_by(clusters) %>% summarise_all(quantile)
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters = 1) %>%
quantile()
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == 1) %>%
quantile()
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == 1)
View(t1)
View(t1)
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == 1) %>%
across(-clusters) %>% quantile()
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == 1) %>%
summarize(across(-clusters)) %>% quantile()
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == 1) %>%
summarize(across(-clusters)) %>% quantile(.,probs = c(0.25, 0.5, 0.75))
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == 1) %>%
summarize(across(-clusters, ~ quantile(., probs = c(0.25, 0.5, 0.75))))
View(t1)
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == 1) %>%
summarize(across(-clusters, ~ quantile(., probs = c(0.25, 0.5, 0.75)))) %>%
cbind(., stat=c('Q1','Mean','Q3'))
cluster_means <- cluster_mean(1)
cluster_mean <- function(cluster){
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == cluster) %>%
summarize(across(-clusters, ~ quantile(., probs = c(0.25, 0.5, 0.75)))) %>%
cbind(., stat=c('Q1','Mean','Q3'))}
cluster_means <- cluster_mean(1)
cluster_means <- sapply(c(1,2,3,4,5,6,7,8,9), cluster_mean)
View(cluster_means2)
View(cluster_means)
results <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ your_function(.x))
cluster_mean <- function(cluster){
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == cluster) %>%
summarize(across(-clusters, ~ quantile(., probs = c(0.25, 0.5, 0.75)))) %>%
cbind(., stat=c('Q1','Mean','Q3'))}
results <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x))
View(results)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x))
cluster_mean <- function(cluster){
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == cluster) %>%
summarize(across(-clusters, ~ quantile(., probs = c(0.25, 0.5, 0.75)))) %>%
cbind(., stat=c('Q1','Mean','Q3'))}
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x))
clusters <- kmeans(basin_tracts_final_scalled, centers=9, nstart=25)$cluster
results <- cbind(basin_tracts_4 %>% select('geometry'),basin_tracts_final_scalled,clusters)
ggplot()+
geom_sf(data=results,aes(fill=as.factor(clusters)),color='transparent')+
theme_void()
cluster_mean <- function(cluster){
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == cluster) %>%
summarize(across(-clusters, ~ quantile(., probs = c(0.25, 0.5, 0.75)))) %>%
cbind(., stat=c('Q1','Mean','Q3'))}
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x))
View(cluster_stats)
cluster_mean <- function(cluster){
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == cluster) %>%
summarize(across(-clusters, ~ quantile(., probs = c(0.25, 0.5, 0.75)))) %>%
cbind(., stat=c('Q1','Mean','Q3'))}
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x))
View(cluster_stats)
cluster_stats <- results %>%
st_drop_geometry() %>%
groupby(cluster) %>% quantile(., probs = c(0.25, 0.5, 0.75))
cluster_mean <- function(cluster){
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == cluster) %>%
summarize(across(-clusters, ~ quantile(., probs = c(0.25, 0.5, 0.75)))) %>%
mutate(cluster = cluster) %>%
cbind(., stat=c('Q1','Mean','Q3'))}
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x))
View(cluster_stats)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(-cluster,-state,names_to='variables',values_to='values')
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(-cluster,-stat,names_to='variables',values_to='values')
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x))
View(cluster_stats)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(-cluster,-stat,names_to='variables',values_to='values')
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values')
View(cluster_stats)
quantiles <- sapply(basin_tracts_final_scalled, function(x) quantile(x, na.rm = TRUE),probs = c(0.25,0.5,0.75))
quantiles <- sapply(basin_tracts_final_scalled, function(x) quantile(x, na.rm = TRUE,probs = c(0.25,0.5,0.75)))
View(quantiles)
cluster_means <- results %>% group_by(clusters) %>% st_drop_geometry() %>% summarise_all(mean) %>% mutate_if(is.numeric, round, digits=2)
quantiles <- sapply(basin_tracts_final_scalled, function(x) quantile(x, na.rm = TRUE,probs = c(0.25,0.5,0.75)))
cluster_means %>%
kbl() %>%
kable_minimal() %>%
column_spec(2,background=ifelse(cluster_means$flood_pct > quantiles[3,1],'red','white')) %>%
column_spec(3,background=ifelse(cluster_means$pct_minority > quantiles[3,2],'red','white')) %>%
column_spec(4,background=ifelse(cluster_means$pct_non_english > quantiles[3,3],'red','white')) %>%
column_spec(5,background=ifelse(cluster_means$pct_poverty > quantiles[3,4],'red','white')) %>%
column_spec(6,background=ifelse(cluster_means$pct_no_university > quantiles[3,5],'red','white')) %>%
column_spec(7,background=ifelse(cluster_means$air_index > quantiles[3,6],'red','white')) %>%
column_spec(8,background=ifelse(cluster_means$Wastewater > quantiles[3,7],'red','white')) %>%
column_spec(9,background=ifelse(cluster_means$health_hazard_index > quantiles[3,8],'red','white')) %>%
column_spec(10,background=ifelse(cluster_means$waste_proximity > quantiles[3,9],'red','white'))
t <- quantiles %>% as_data_frame() %>%
cbind(.,stat=c('Q1','Mean','Q3')) %>%
pivot_longer(-stat,names_to='variables',values_to='value')
means <- t %>%
filter(stat == "Mean")
q3 <- t %>%
filter(stat == "Q3")
results_long <- results %>%
st_drop_geometry() %>%
pivot_longer(-clusters,names_to='variables',values_to='value')
ggplot(data=results_long)+
geom_boxplot(aes(x=as.factor(clusters),y=value,fill=as.factor(clusters)))+
geom_hline(data=means,aes(yintercept=value),color='orange',linewidth=1)+
geom_hline(data=q3,aes(yintercept=value),color='red',linewidth=1)+
facet_wrap(~variables,nrow=2)+
theme_bw()
ggsave('image1.png')
View(cluster_stats)
t <- quantiles %>% as_data_frame() %>%
cbind(.,stat=c('Q1','Mean','Q3'))
View(t)
t <- quantiles %>% as_data_frame() %>%
cbind(.,stat=c('Q1','Mean','Q3')) %>%
pivot_longer(-stat,names_to='variables',values_to='value')
View(t)
a <- t %>%
pivot_wider(id_cols=variables,names_from=stat)
View(a)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat))
View(cluster_stats)
t <- quantiles %>% as_data_frame() %>%
cbind(.,stat=c('Q1','Mean','Q3')) %>%
pivot_longer(-stat,names_to='variables',values_to='value')
means <- t %>%
filter(stat == "Mean")
q3 <- t %>%
filter(stat == "Q3")
results_long <- results %>%
st_drop_geometry() %>%
pivot_longer(-clusters,names_to='variables',values_to='value')
ggplot(data=results_long)+
geom_boxplot(aes(x=as.factor(clusters),y=value,fill=as.factor(clusters)))+
geom_hline(data=means,aes(yintercept=value),color='orange',linewidth=1)+
geom_hline(data=q3,aes(yintercept=value),color='red',linewidth=1)+
facet_wrap(~variables,nrow=2)+
theme_bw()
ggsave('image1.png')
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat = 'Mean' & values > Q3, 'Yes', 'No')
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 'Yes', 'No'))
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q3' & values > Mean),1,0)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q3' & values > Mean),1,0))
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q3' & values > Mean,1,0))
cluster_mean <- function(cluster){
t1 <- results %>%
st_drop_geometry() %>%
filter(clusters == cluster) %>%
summarize(across(-clusters, ~ quantile(., probs = c(0.25, 0.5, 0.75)))) %>%
mutate(cluster = cluster) %>%
cbind(., stat=c('Q1','Mean','Q3'))}
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0))
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,0))
View(cluster_stats)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,0)) %>%
groupby(variable,cluster) %>% max(flag)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,0)) %>%
group_by(variable,cluster) %>% max(flag)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,0)) %>%
group_by(variables,cluster) %>% max(flag)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,0))
View(cluster_stats)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,0)) %>%
group_by(variables,cluster) %>% max(flag)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,0)) %>%
group_by(variables,cluster) %>% max(flag)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,0)) %>%
group_by(variables,cluster) %>% summarize(flag = max(flag))
View(cluster_stats)
View(cluster_stats)
View(cluster_stats)
View(cluster_stats)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,0)) %>%
group_by(variables,cluster) %>% summarize(flag = max(flag)) %>%
pivot_wider(names_from='variables',values_from='flag')
View(cluster_stats)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,0)) %>%
group_by(variables,cluster) %>% summarize(flag = max(flag))
View(cluster_stats)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,0))
View(cluster_stats)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,flag)) %>%
group_by(variables,cluster) %>% summarize(flag = max(flag))
View(cluster_stats)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,flag)) %>%
group_by(variables,cluster) %>% summarize(flag = max(flag)) %>%
pivot_wider(names_from='variables',values_from='flag')
View(cluster_stats)
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,flag)) %>%
group_by(variables,cluster) %>% summarize(flag = max(flag))
cluster_stats <- map_dfr(c(1,2,3,4,5,6,7,8,9), ~ cluster_mean(.x)) %>%
pivot_longer(cols=c(-cluster,-stat),names_to='variables',values_to='values') %>%
left_join(.,t %>% pivot_wider(id_cols=variables,names_from=stat)) %>%
mutate(flag = ifelse(stat == 'Mean' & values > Q3, 1, 0),
flag = ifelse(stat == 'Q1' & values > Mean,1,0),
flag = ifelse(stat == 'Q1' & values > Q3,2,flag)) %>%
group_by(variables,cluster) %>% summarize(flag = max(flag))
